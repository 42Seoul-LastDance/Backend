<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>4242</title>
    </head>
    <body>
        <div id="content">
            <!-- Content to be shown to the user -->
        </div>
        <div id="42login" style="display: none">
            <button id="login42Button">42Login</button>
        </div>
        <div id="refresh" style="display: none">
            <button id="refreshButton">refresh</button>
        </div>
        <div id="logout" style="display: none">
            <button id="logoutButton">logout</button>
        </div>

        <script>
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }

            window.addEventListener('load', () => {
                const access_token = getCookie('access_token');
                const refresh_token = getCookie('refresh_token');

                if (access_token) {
                    document.getElementById('content').innerText = 'logged in';
                    document.getElementById('logout').style.display = 'block';
                } else if (refresh_token) {
                    document.getElementById('content').innerText =
                        'have refresh token';
                    document.getElementById('refresh').style.display = 'block';
                } else {
                    document.getElementById('42login').style.display = 'block';
                }
            });

            const checkLogout = document.getElementById('logoutButton');
            logout.addEventListener('click', async () => {
                const access_token = getCookie('access_token');
                const refresh_token = getCookie('refresh_token');

                const headers = {
                    Authorization: `Bearer ${access_token}`, // access_token을 Bearer 토큰으로 사용
                    'Refresh-Token': refresh_token, // refresh_token을 사용자 정의 헤더로 추가
                    'Content-Type': 'application/json', // 요청 데이터가 JSON 형식인 경우
                };
                const requestOptions = {
                    method: 'POST',
                    headers: headers,
                };
                const response = await fetch(
                    'http://10.11.8.6:3000/auth/logout',
                    requestOptions,
                );
                if (!response.ok) {
                    alert('sth went wrong!');
                }
                const data = response.json();
                alert('data: ', data);
            });

            const checkRefresh = document.getElementById('refreshButton');
            checkRefresh.addEventListener('click', async () => {
                const refresh_token = getCookie('refresh_token');
                const headers = {
                    // Authorization: `Bearer ${refresh_token}`, // access_token을 Bearer 토큰으로 사용
                    'Refresh-Token': refresh_token, // refresh_token을 사용자 정의 헤더로 추가
                    'Content-Type': 'application/json', // 요청 데이터가 JSON 형식인 경우
                };
                const requestOptions = {
                    method: 'GET',
                    headers: headers,
                };

                const response = await fetch(
                    'http://10.11.8.6:3000/auth/regenerate-token',
                );

                if (!response.ok) {
                    alert('sth went wrong!');
                } else {
                    alert('access_token regenerated');
                }
            });

            const login42Button = document.getElementById('login42Button');
            login42Button.addEventListener('click', async () => {
                // const response = await fetch(
                //     'http://10.11.8.6:3000/auth/42login',
                //     {
                //         mode: 'no-cors',
                //     },
                // );

                // if (!response.ok) {
                //     alert('sth went wrong!');
                // }
                // // const data = await response.json();
                // alert('data: ', response);
                window.location.href = 'http://10.11.8.6:3000/auth/42login';
            });
        </script>
    </body>
</html>
